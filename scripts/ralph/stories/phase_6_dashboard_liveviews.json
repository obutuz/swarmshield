{
  "branchName": "ralph/phase-6-dashboard",
  "description": "Real-time security operations center dashboard with GhostProtocol visibility. LiveViews for monitoring events, agents, deliberations, GhostProtocol ephemeral sessions, and audit logs with PubSub-driven real-time updates.",
  "phase": 6,
  "phaseName": "Dashboard LiveViews",
  "crossPhaseLinks": {
    "phase_1_auth_foundation": "All views use auth hooks for workspace scoping and permission checks.",
    "phase_2_core_schemas": "Displays all domain schemas - events, agents, sessions, verdicts, ghost protocol configs.",
    "phase_3_policy_engine": "Dashboard shows policy evaluation stats and violation counts.",
    "phase_4_api_gateway": "Subscribes to PubSub for real-time event and violation updates.",
    "phase_5_deliberation_engine": "Subscribes to PubSub for real-time deliberation progress and GhostProtocol lifecycle events.",
    "phase_7_admin_liveviews": "Dashboard links to admin configuration views including GhostProtocol config.",
    "phase_8_demo_polish": "Dashboard populated by demo simulator. GhostProtocol visuals integrated."
  },
  "securityRules": {
    "authorization": "All mount/0 check permissions via on_mount hooks. All handle_event re-verify permissions.",
    "workspace_scoping": "PubSub topics use workspace_id from server-side assigns. Detail views verify record belongs to current workspace.",
    "xss": "Phoenix auto-escapes all rendered content. NEVER use raw/1 on event content, deliberation messages, verdict reasoning.",
    "data_exposure": "Only show data within current workspace scope. API key displayed only as masked prefix.",
    "no_repo_in_liveview": "All data loaded through context functions, never direct Repo calls.",
    "ghost_protocol_visibility": "GhostProtocol dashboard shows real-time wipe status. Wiped fields show [WIPED] placeholder."
  },
  "userStories": [
    {
      "id": "DASH-001",
      "title": "Create app layout with sidebar navigation",
      "description": "Application layout with dark-themed sidebar navigation, workspace selector, and user menu. This is the shell that all dashboard and admin views render within.",
      "priority": 1,
      "passes": true,
      "dependsOn": [],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "Layout at lib/swarmshield_web/components/layouts/app.html.heex",
        "Dark theme: bg-gray-900 text-gray-100 color scheme",
        "Sidebar with navigation links: Dashboard, Events, Agents, Deliberations, GhostProtocol, Audit Log",
        "Admin section in sidebar (admin/super_admin only): Workflows, Policies, Detection Rules, Agent Definitions, Prompt Templates, GhostProtocol Configs, Settings, Users",
        "GhostProtocol nav item with ghost icon (Heroicons)",
        "Workspace name and selector in sidebar header",
        "User menu with email and logout link",
        "Mobile responsive: hamburger menu on small screens",
        "Active navigation item highlighted",
        "Uses Phoenix 1.8 layout patterns",
        "Tests for layout rendering with different roles",
        "Edge case: sidebar collapses on mobile (< 768px)",
        "Edge case: active nav item highlighted for nested routes",
        "Edge case: admin section hidden for analyst and viewer roles",
        "Edge case: GhostProtocol nav visible to all roles with ghost_protocol:view permission",
        "SECURITY: Logout link must use DELETE method with CSRF token",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-002",
      "title": "Create DashboardLive (stats, charts, live counters)",
      "description": "Main dashboard showing real-time security metrics including GhostProtocol stats: active ephemeral sessions, total sessions wiped, data destroyed.",
      "priority": 2,
      "passes": true,
      "dependsOn": [
        "DASH-001"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/dashboard_live.ex",
        "Route: live '/dashboard', DashboardLive",
        "Permission check on mount: dashboard:view",
        "Stat cards: Total Events (24h), Flagged Events, Blocked Events, Active Agents, Active Deliberations, Verdicts Today",
        "GhostProtocol stat cards: Active Ephemeral Sessions, Total Sessions Wiped, Average Wipe Duration",
        "Stats loaded via context functions (not direct Repo)",
        "Subscribes to PubSub 'events:workspace_id' for real-time counter updates",
        "Subscribes to PubSub 'deliberations:workspace_id' for session updates",
        "Subscribes to PubSub 'ghost_protocol:workspace_id' for GhostProtocol updates",
        "handle_info updates stat counters on new events (no full page reload)",
        "Uses assign_async for initial data load (extract values before callback)",
        "Responsive grid: 3 columns desktop, 2 tablet, 1 mobile",
        "Tests for mount, PubSub updates, permission check",
        "Edge case: empty workspace shows 0 counts",
        "Edge case: GhostProtocol stats show 0 if no ephemeral sessions configured",
        "Edge case: assign_async values extracted BEFORE callback",
        "QUERY QUALITY: All dashboard stats via single database query using conditional aggregates",
        "QUERY QUALITY: GhostProtocol stats via JOIN through workflow to ghost_protocol_config",
        "Minimum 6 test cases",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-003",
      "title": "Create EventsLive (stream, filters, search)",
      "description": "Event list view with real-time streaming, filtering by status/type/agent, and search.",
      "priority": 3,
      "passes": true,
      "dependsOn": [
        "DASH-001"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/events_live.ex",
        "Route: live '/events', EventsLive",
        "Permission check on mount: events:view",
        "Uses streams for event list",
        "Filters: status, event_type, registered_agent, date range",
        "Search: content text search with phx-debounce='300'",
        "Pagination: offset/limit",
        "Subscribes to PubSub 'events:workspace_id' for real-time new events",
        "New events prepended to stream via stream_insert",
        "Color-coded status badges: green (allowed), yellow (flagged), red (blocked)",
        "Each row links to EventShowLive",
        "All data via context functions",
        "Tests for mount, filtering, stream updates",
        "Edge case: empty event list shows 'No events yet' message",
        "Edge case: combined filters work correctly",
        "QUERY QUALITY: Filter composition builds single SQL query",
        "QUERY QUALITY: Pagination uses database LIMIT/OFFSET",
        "Minimum 8 test cases",
        "SECURITY: Search uses parameterized queries - NEVER string interpolation",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-004",
      "title": "Create EventShowLive (event detail + policy evaluation)",
      "description": "Event detail view showing full event data, policy evaluation results, matched rules, and linked deliberation session.",
      "priority": 4,
      "passes": true,
      "dependsOn": [
        "DASH-003"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/event_show_live.ex",
        "Route: live '/events/:id', EventShowLive",
        "Permission check on mount: events:view",
        "Displays: event_type, content, payload (formatted JSON), status, severity, timestamps",
        "Shows evaluation_result: matched rules with names and actions",
        "Shows linked PolicyViolations if any",
        "Shows linked AnalysisSession with verdict if deliberation occurred",
        "If session was ephemeral: show GhostProtocol badge, show [WIPED] for wiped fields",
        "Link to trigger manual deliberation (if has permission)",
        "All data via context functions with preloads",
        "Tests for mount, event display, linked data",
        "Edge case: event not found returns 404",
        "Edge case: ephemeral session verdict visible but deliberation messages show [WIPED]",
        "Minimum 6 test cases",
        "SECURITY: Event verified to belong to current workspace - return 404 for wrong-workspace",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-005",
      "title": "Create AgentsLive (registered agent registry)",
      "description": "Registered agent registry showing all monitored AI agents with status, risk level, event counts.",
      "priority": 5,
      "passes": true,
      "dependsOn": [
        "DASH-001"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/agents_live.ex",
        "Route: live '/agents', AgentsLive",
        "Permission check on mount: agents:view",
        "Uses streams for agent list",
        "Displays: name, agent_type, status, risk_level, event_count, last_seen_at",
        "Filter by: status, agent_type, risk_level",
        "Color-coded risk level badges",
        "Each row links to AgentShowLive",
        "All data via Gateway context functions",
        "Tests for mount, filtering",
        "Edge case: empty agent list shows 'No agents registered' message",
        "Edge case: last_seen_at shows relative time",
        "Minimum 4 test cases",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-006",
      "title": "Create AgentShowLive (agent detail + event history)",
      "description": "Agent detail view showing agent configuration, recent events, violation history.",
      "priority": 6,
      "passes": true,
      "dependsOn": [
        "DASH-005"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/agent_show_live.ex",
        "Route: live '/agents/:id', AgentShowLive",
        "Permission check on mount: agents:view",
        "Displays: name, description, agent_type, status, risk_level, API key prefix (masked), metadata",
        "Recent events tab: last 50 events via streams",
        "Violations tab: linked policy violations",
        "Stats: total events, flagged count, blocked count",
        "Subscribes to PubSub for real-time event updates for this agent",
        "All data via context functions with preloads",
        "Tests for mount, tab switching, real-time updates",
        "Edge case: agent not found returns 404",
        "Edge case: API key displayed as masked 'sk-xxxxxxxx'",
        "Minimum 5 test cases",
        "SECURITY: Agent verified to belong to current workspace",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-007",
      "title": "Create DeliberationsLive (session list with GhostProtocol status)",
      "description": "Deliberation session list showing all analysis sessions with status, workflow used, verdict outcome, and GhostProtocol ephemeral indicator.",
      "priority": 7,
      "passes": true,
      "dependsOn": [
        "DASH-001"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/deliberations_live.ex",
        "Route: live '/deliberations', DeliberationsLive",
        "Permission check on mount: deliberations:view",
        "Uses streams for session list",
        "Displays: status, workflow name, trigger type, verdict decision, confidence, duration, cost",
        "GhostProtocol column: ghost icon for ephemeral sessions, wipe status (pending/completed/wiped)",
        "Filter by: status, trigger type, verdict decision, ephemeral (yes/no)",
        "Status badges with icons: analyzing (spinner), deliberating (chat), voting (ballot), completed (check), wiping (ghost)",
        "Each row links to DeliberationShowLive",
        "Subscribes to PubSub 'deliberations:workspace_id' and 'ghost_protocol:workspace_id'",
        "All data via Deliberation context functions",
        "Tests for mount, filtering, real-time updates",
        "Edge case: empty deliberation list shows message",
        "Edge case: ephemeral session shows ghost icon + countdown to wipe",
        "Edge case: wiped session shows 'Wiped' badge in green",
        "Minimum 5 test cases",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-008",
      "title": "Create DeliberationShowLive (real-time debate viewer)",
      "description": "Real-time deliberation viewer showing live debate between AI agents. For ephemeral sessions, shows GhostProtocol lifecycle with wipe visualization.",
      "priority": 8,
      "passes": true,
      "dependsOn": [
        "DASH-007"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/deliberation_show_live.ex",
        "Route: live '/deliberations/:id', DeliberationShowLive",
        "Permission check on mount: deliberations:view",
        "Displays session info: status, workflow, trigger, event summary, timing",
        "Agent panel: each agent with role, assessment, vote, confidence",
        "Message timeline: chronological display grouped by round",
        "Messages color-coded by type: analysis (blue), argument (green), counter_argument (orange)",
        "Verdict panel: decision, confidence, reasoning, vote breakdown, dissenting opinions",
        "GhostProtocol panel (if ephemeral): lifecycle status (spawn -> analyze -> debate -> verdict -> wipe -> dead), countdown timer to expires_at, wipe status, crypto_shred indicator",
        "For wiped sessions: deliberation messages show [WIPED] placeholder, verdict remains visible",
        "Subscribes to PubSub 'deliberation:session_id' and 'ghost_protocol:session_id'",
        "New messages appear live via stream_insert",
        "Verdict appears automatically when reached",
        "Wipe visualization triggered by PubSub ghost_protocol events",
        "All data via Deliberation and GhostProtocol context functions",
        "Tests for mount, real-time messages, verdict, wipe visualization",
        "Edge case: session not found returns 404",
        "Edge case: wiped messages show [WIPED] with original timestamp preserved",
        "Edge case: verdict card survives wipe (stays visible with all fields)",
        "Edge case: GhostProtocol countdown timer updates in real-time",
        "Minimum 8 test cases",
        "SECURITY: Session verified to belong to current workspace",
        "SECURITY: Deliberation message content auto-escaped (no raw/1)",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-009",
      "title": "Create GhostProtocolLive (active ephemeral sessions + wipe history)",
      "description": "GhostProtocol dashboard showing live ephemeral sessions with countdown timers, wipe status, and historical wipe data. This is the dedicated GhostProtocol operations view.",
      "priority": 9,
      "passes": true,
      "dependsOn": [
        "DASH-001"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/ghost_protocol_live.ex",
        "Route: live '/ghost-protocol', GhostProtocolLive",
        "Permission check on mount: ghost_protocol:view",
        "Active Sessions section: live list of active ephemeral sessions with countdown timers (expires_at)",
        "Each active session shows: session ID, workflow name, agent count, current phase (analyzing/deliberating/wiping), time remaining",
        "Countdown timers update in real-time via JS hook or periodic timer",
        "Wipe History section: recent sessions with wipe status (completed/pending/failed)",
        "Each history entry shows: session ID, wipe_strategy used, fields wiped, crypto_shred status, wipe duration",
        "Stats panel: total sessions wiped, average session duration, total data destroyed, active configs count",
        "PubSub subscription to 'ghost_protocol:workspace_id' for real-time updates",
        "Active session appears when ephemeral deliberation starts, disappears when wipe completes",
        "Uses streams for both active sessions and history lists",
        "All data via GhostProtocol context functions",
        "Tests for mount, real-time updates, countdown timers",
        "Edge case: no active ephemeral sessions shows 'No active ghost sessions' empty state",
        "Edge case: no wipe history shows 'No wipe history' empty state",
        "Edge case: session that expires shows visual alert (red border/flash)",
        "Edge case: wipe completion triggers stream_delete from active + stream_insert to history",
        "Edge case: stats computed from database aggregates (not in-memory counting)",
        "Minimum 6 test cases",
        "SECURITY: All data scoped to current workspace",
        "SECURITY: PubSub topic uses workspace_id from server-side assigns",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-010",
      "title": "Create GhostProtocolSessionLive (session lifecycle detail)",
      "description": "Detailed view of a single GhostProtocol ephemeral session lifecycle. Shows real-time spawn -> analyze -> debate -> verdict -> wipe -> dead lifecycle with agent status cards and wipe details.",
      "priority": 10,
      "passes": true,
      "dependsOn": [
        "DASH-009"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/ghost_protocol_session_live.ex",
        "Route: live '/ghost-protocol/:id', GhostProtocolSessionLive",
        "Permission check on mount: ghost_protocol:view",
        "Lifecycle timeline: visual progress bar showing phases (spawn -> analyze -> debate -> verdict -> wipe -> dead)",
        "Current phase highlighted with animation",
        "Agent status cards: each agent with role, status, terminated_at timestamp",
        "Countdown to expiry: visual progress bar showing time remaining before force-terminate",
        "Wipe details panel (after wipe): which fields were wiped, crypto_shred status, wipe duration",
        "Surviving artifacts panel: verdict summary (always visible), audit entries for this session",
        "Config details: linked ghost_protocol_config settings (wipe_strategy, wipe_fields, etc.)",
        "PubSub subscription to 'ghost_protocol:session_id' for real-time lifecycle updates",
        "Phase transitions animate in real-time as they occur",
        "All data via GhostProtocol and Deliberation context functions",
        "Tests for mount, lifecycle display, wipe details",
        "Edge case: session not found returns 404",
        "Edge case: non-ephemeral session redirects to /deliberations/:id",
        "Edge case: active session shows live countdown and phase transitions",
        "Edge case: completed/wiped session shows full lifecycle history with timestamps",
        "Edge case: agent cards show terminated_at for dead agents",
        "Edge case: verdict card remains solid/visible even after all other data wiped",
        "Minimum 6 test cases",
        "SECURITY: Session verified to belong to current workspace",
        "SECURITY: Wiped content fields show [WIPED] - never attempt to display NULL as empty string",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    },
    {
      "id": "DASH-011",
      "title": "Create AuditLive (paginated audit log)",
      "description": "Paginated audit log showing all system actions including GhostProtocol wipe events. Filterable and searchable.",
      "priority": 11,
      "passes": false,
      "dependsOn": [
        "DASH-001"
      ],
      "acceptanceCriteria": [
        "MANDATORY: Read progress.txt for existing implementations BEFORE coding - NO DUPLICATES",
        "LiveView at lib/swarmshield_web/live/audit_live.ex",
        "Route: live '/audit', AuditLive",
        "Permission check on mount: audit:view",
        "Uses streams for audit entry list",
        "Displays: action, resource_type, resource_id, actor_email, ip_address, timestamp, metadata preview",
        "GhostProtocol wipe entries highlighted with ghost icon",
        "Filter by: action (including 'ghost_protocol_wipe'), resource_type, actor, date range",
        "Search by actor email or resource ID",
        "Pagination (offset/limit)",
        "Export button (if has audit:export permission)",
        "No edit/delete actions (audit is immutable)",
        "All data via Accounts.list_audit_entries/1",
        "Tests for mount, filtering, pagination",
        "Edge case: empty audit log shows message",
        "Edge case: metadata preview shows first 100 chars with expand option",
        "Edge case: GhostProtocol wipe entries show 'fields_wiped' and 'crypto_shred' in metadata",
        "QUERY QUALITY: Uses indexed [:workspace_id, :inserted_at] for date-range filtering",
        "Minimum 6 test cases",
        "SECURITY: Search uses parameterized queries",
        "SECURITY: Export uses POST with CSRF token",
        "mix format passes",
        "mix credo --strict passes",
        "mix test passes"
      ]
    }
  ]
}

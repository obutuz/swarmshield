# SwarmShield - Ralph Build Progress
# This file is updated by Ralph after each iteration.
# Format: [STORY-ID] [STATUS] [TIMESTAMP] [NOTES]
# ---
# Patterns established:
# - App: Swarmshield / SwarmshieldWeb
# - Binary IDs: @primary_key {:id, :binary_id, autogenerate: true}
# - Timestamps: timestamps(type: :utc_datetime)
# - All enums via Ecto.Enum
# - ETS caches: try/rescue in handle_continue
# - No direct Repo in LiveViews
# - PubSub for real-time updates
# ---
AUTH-001 DONE 2026-02-10 Run mix phx.gen.auth with binary_id - 112 tests pass, credo clean
AUTH-003 DONE 2026-02-10 Create Workspace schema and migration - 132 tests pass, credo clean
AUTH-004 DONE 2026-02-10 Create Role schema with database-driven permissions - 169 tests pass, credo clean
AUTH-005 DONE 2026-02-10 Create Permission schema - 169 tests pass, credo clean
AUTH-006 DONE 2026-02-10 Create RolePermission join table - 169 tests pass, credo clean
AUTH-007 DONE 2026-02-10 Create UserWorkspaceRole junction - 180 tests pass, credo clean
AUTH-012 DONE 2026-02-10 Create AuditEntry schema - 217 tests pass, credo clean
AUTH-008 DONE 2026-02-10 Create Accounts context functions - 253 tests pass, credo clean
AUTH-009 DONE 2026-02-10 Create Authorization module with ETS-backed AuthCache - 282 tests pass, credo clean
AUTH-010 DONE 2026-02-10 Seed default roles and permissions - 282 tests pass, credo clean
AUTH-011 DONE 2026-02-10 Create workspace-scoped LiveView hooks - 303 tests pass, credo clean
AUTH-013 DONE 2026-02-10 Post-login redirect and workspace resolution - 317 tests pass, credo clean
AUTH-014 DONE 2026-02-10 Onboarding flow - create first workspace - 332 tests pass, credo clean
AUTH-015 DONE 2026-02-10 Wire router.ex with live_session blocks and on_mount hooks - 357 tests pass, credo clean
SCHEMA-001 DONE 2026-02-11 Create RegisteredAgent schema - 401 tests pass, credo clean
SCHEMA-002 DONE 2026-02-11 Create AgentEvent schema - 721 tests pass, credo clean
SCHEMA-003 DONE 2026-02-11 Create PolicyRule schema - 721 tests pass, credo clean
SCHEMA-004 DONE 2026-02-11 Create DetectionRule schema - 721 tests pass, credo clean
SCHEMA-005 DONE 2026-02-11 Create PolicyViolation schema - 721 tests pass, credo clean
SCHEMA-006 DONE 2026-02-11 Create AgentDefinition schema - 721 tests pass, credo clean
SCHEMA-007 DONE 2026-02-11 Create PromptTemplate schema - 721 tests pass, credo clean
SCHEMA-008 DONE 2026-02-11 Create Workflow schema - 721 tests pass, credo clean
SCHEMA-009 DONE 2026-02-11 Create WorkflowStep schema - 721 tests pass, credo clean
SCHEMA-010 DONE 2026-02-11 Create ConsensusPolicy schema - 721 tests pass, credo clean
SCHEMA-011 DONE 2026-02-11 Create AnalysisSession schema - 721 tests pass, credo clean
SCHEMA-012 DONE 2026-02-11 Create AgentInstance schema - 721 tests pass, credo clean
SCHEMA-013 DONE 2026-02-11 Create DeliberationMessage schema - 721 tests pass, credo clean
SCHEMA-014 DONE 2026-02-11 Create Verdict schema - 721 tests pass, credo clean
POLICY-001 DONE 2026-02-11 Create Gateway context - 766 tests pass, credo clean
POLICY-002 DONE 2026-02-11 Create Policies context - 830 tests pass, credo clean
AUDIT-001 DONE 2026-02-11 Add missing indexes (8 indexes: 3 FK + 3 dashboard + 2 perf) - 843 tests pass, credo clean
AUDIT-002 DONE 2026-02-11 Fix ReDoS detection (100ms timeout + non-matching input) - 843 tests pass, credo clean
AUDIT-003 DONE 2026-02-11 Add edge case tests (ReDoS, template security, null bytes, FK cascades) - 843 tests pass, credo clean
POLICY-003 DONE 2026-02-11 Create PolicyCache GenServer with ETS - 843 tests pass, credo clean
POLICY-004 DONE 2026-02-11 Create PolicyEngine pure-function module - 853 tests pass, credo clean
POLICY-005 DONE 2026-02-11 Rate limit rule evaluation (ETS sliding window counters) - 890 tests pass, credo clean
POLICY-006 DONE 2026-02-11 Pattern match rule evaluation (regex + keyword detection) - 890 tests pass, credo clean
POLICY-007 DONE 2026-02-11 Blocklist/allowlist rule evaluation - 890 tests pass, credo clean
POLICY-008 DONE 2026-02-11 Payload size rule evaluation - 890 tests pass, credo clean
POLICY-009 DONE 2026-02-11 Composite rule evaluation - wire all evaluators into PolicyEngine - 899 tests pass, credo clean
POLICY-010 DONE 2026-02-11 Seed default policy rules and detection rules (8 detection + 8 policy, idempotent) - 899 tests pass, credo clean
POLICY-011 DONE 2026-02-11 Create ApiKeyCache GenServer with ETS - 912 tests pass, credo clean
SCHEMA-015 DONE 2026-02-11 Create GhostProtocolConfig schema and add FK to Workflow - 965 tests pass, credo clean
AUDIT-004 DONE 2026-02-11 Add Phase 3 edge case tests (ReDoS timeout, window expiry, concurrent lookups, negative TTL, crash recovery) - 965 tests pass, credo clean
GW-001 DONE 2026-02-11 Create ApiAuth plug (Bearer token auth, ETS cache lookup, async last_seen_at, audit trail, workspace validation) - 986 tests pass, credo clean
GW-002 DONE 2026-02-11 Create API pipeline in router.ex (RequireJson, CorsHeaders, ApiSecurityHeaders, ApiRateLimit, HealthController) - 1019 tests pass, credo clean
GW-003 DONE 2026-02-11 Create EventController (POST /api/v1/events with explicit param extraction, source_ip from conn, audit trail) - 1037 tests pass, credo clean
GW-004 DONE 2026-02-11 Create EventJSON view module (index/show, no workspace_id exposure, ISO 8601 datetimes) - 1037 tests pass, credo clean
GW-005 DONE 2026-02-11 Wire PolicyEngine into EventController (evaluate->update status->create violations, try/catch resilience, sanitized eval result) - 1227 tests pass, credo clean
GW-006 DONE 2026-02-11 PubSub broadcast on event ingestion (events:ws_id + violations:ws_id, preloaded assocs, rescue on failure) - 1235 tests pass, credo clean
GW-007 DONE 2026-02-11 Auto-trigger deliberation on flagged events (Task.Supervisor async, find_matching_workflow DB query, audit trail) - 1274 tests pass, credo clean
GW-008 DONE 2026-02-11 Create HealthController (DB connectivity check with 5s timeout, Application.spec version, ISO 8601 timestamp, no info leakage) - 1274 tests pass, credo clean
AUDIT-005 DONE 2026-02-11 Phase 4 security audit: CORS wildcard default fixed (empty by default), changeset_json rescue on atom conversion, CORS test coverage for edge cases - 1307 tests pass, credo clean
AUDIT-006 DONE 2026-02-11 Phase 4 deep edge case audit: removed duplicate find_matching_workflow (use get_enabled_workflow_for_trigger), fixed N+1 in broadcast_violations_created (batch preload), added Vary:Origin CORS header, cleaned dead audit_auth_failure param - 1318 tests pass, credo clean
DELIB-001 DONE 2026-02-11 Create Deliberation context (AnalysisSession/AgentInstance/DeliberationMessage/Verdict CRUD, workspace-scoped, paginated, PubSub, status transitions) - 33 tests, credo clean
DELIB-002 DONE 2026-02-11 Create Agents context (AgentDefinition/PromptTemplate CRUD, referential integrity checks, workspace-scoped, audit trail) - 25 tests, credo clean
DELIB-003 DONE 2026-02-11 Create Workflows context (Workflow/WorkflowStep/ConsensusPolicy CRUD, step reordering via Ecto.Multi, ghost_protocol_config preloads) - 33 tests, credo clean
DELIB-004 DONE 2026-02-11 Create GhostProtocol context (Config CRUD, active ephemeral sessions query, PubSub broadcasts, workspace-scoped) - 21 tests, credo clean
DELIB-005 DONE 2026-02-11 Create PromptRenderer module (pure functions, {{variable}} interpolation, no Code.eval_string, safe String.replace/3) - 29 tests, credo clean
DELIB-006 DONE 2026-02-11 Create LLM Budget Agent (GenServer + ETS, atomic update_counter, try/rescue handle_continue, ArgumentError rescue reads) - 18 tests, credo clean
DELIB-007 DONE 2026-02-11 Create LLM Client module (ReqLLM, retries, budget check, structured message format, mocked HTTP tests) - 29 tests, credo clean
DELIB-008 DONE 2026-02-11 Create Deliberation Session GenServer (DynamicSupervisor, restart: :temporary for ephemeral, lifecycle management, expires_at, input_content_hash) - 16 tests, credo clean
DELIB-009 DONE 2026-02-11 Implement analysis phase (parallel Task.Supervisor, extract values before tasks, Task.yield_many, partial failure handling) - part of session tests, credo clean
DELIB-010 DONE 2026-02-11 Implement deliberation phase (multi-round cross-agent debate, configurable rounds, argument/counter_argument messages) - part of session tests, credo clean
DELIB-011 DONE 2026-02-11 Create Consensus module (majority/supermajority/unanimous/weighted voting, vote_breakdown, confidence_score, dissenting_opinions) - 31 tests, credo clean
DELIB-012 DONE 2026-02-11 Implement verdict phase (consensus evaluation, verdict persistence, event status update, ephemeral wipe trigger, audit trail) - part of session tests, credo clean
DELIB-013 DONE 2026-02-11 Implement GhostProtocol wipe engine (crypto_shred, field nulling, idempotent wipes, immediate/delayed/scheduled strategies, audit trail) - 16 tests, credo clean
DELIB-014 DONE 2026-02-11 Implement GhostProtocol expiry enforcement (Process.send_after, auto_terminate_on_expiry, partial verdicts, force-terminate flow) - part of session tests, credo clean
DASH-001 DONE 2026-02-11 App layout with sidebar navigation (header+sidebar+mobile bottom nav, pact_africa pattern, DaisyUI semantic classes, ghost-protocol routes+stubs, all LiveViews wired) - 1318 tests pass, credo clean
DASH-002 DONE 2026-02-11 DashboardLive (real-time stats, PubSub counters, assign_async, GOD MODE UI with stat cards, 3 context stat functions, permission check) - 1327 tests pass, credo clean
DASH-003 DONE 2026-02-11 EventsLive (streams, composable filters, content search ILIKE, pagination, PubSub prepend, status/type/severity badges, GOD MODE UI) - 1340 tests pass, credo clean
DASH-004 DONE 2026-02-11 EventShowLive (event detail, evaluation results, matched rules, linked violations, linked deliberation+verdict, GhostProtocol ephemeral badge, workspace-scoped 404) - 1349 tests pass, credo clean
DASH-005 DONE 2026-02-11 AgentsLive (streams, composable filters: status/agent_type/search, risk level badges, relative time, pagination, empty state, GOD MODE UI) - 1361 tests pass, credo clean
DASH-006 DONE 2026-02-11 AgentShowLive (agent detail, stats via conditional aggregates, events+violations tabs with streams, PubSub real-time, workspace-scoped 404, metadata display) - 1374 tests pass, credo clean
DASH-007 DONE 2026-02-11 DeliberationsLive (streams, status/trigger filters, verdict+confidence display, GhostProtocol ephemeral badge, workflow preload, PubSub, GOD MODE UI) - 1384 tests pass, credo clean
DASH-008 DONE 2026-02-11 DeliberationShowLive (real-time debate viewer, agent panels with votes/confidence, message timeline with type-colored cards, verdict+dissenting opinions, GhostProtocol panel with crypto_shred, PubSub 3-tuple format, workspace-scoped 404, XSS auto-escape) - 1404 tests pass, credo clean
DASH-009 DONE 2026-02-11 GhostProtocolLive (active ephemeral sessions with countdown, wipe history with crypto_shred indicator, stats panel, PubSub dual-topic subscribe, workspace-scoped, stream empty states) - 1412 tests pass, credo clean
DASH-010 DONE 2026-02-11 GhostProtocolSessionLive (ephemeral session lifecycle timeline, agent status cards with terminated_at, countdown to expiry, surviving verdict artifact, config details panel, non-ephemeral redirect, PubSub 3-tuple handlers, workspace-scoped 404) - 1427 tests pass, credo clean
